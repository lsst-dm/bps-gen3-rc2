##############
#BPS OPERATOR
##############
submitRoot: ${PWD}/submit
operator: madamow
clusterAlgorithm: lsst.ctrl.bps.quantum_clustering_funcs.single_quantum_clustering

createQuantumGraph: pipetask qgraph -d "{dataQuery}" -b {butlerConfig} -i {output} -p {pipelineYaml} -q {qgraphFile} --qgraph-dot {qgraphFile}.dot
runQuantumCommand: "${CTRL_MPEXEC_DIR}/bin/pipetask --long-log run -b {butlerConfig} --output {output} --output-run {outCollection} --extend-run --skip-init-writes --qgraph {qgraphFile} --no-versions"

includeConfigs:
- bps-site-htcondor.yaml
###################

templateDataId: "{tract}_{patch}_{band}_{visit}_{exposure}_{detector}"
pipelineYaml: /home/madamow/gen2-to-gen3/bps/fgcmBuildStarsTableHscRC2.yaml
#qgraphFile: /home/madamow/gen2-to-gen3/bps/submit/RC2/w_2021_02/DM-28282/20210217T154224Z/RC2_w_2021_02_DM-28282_20210217T154224Z.qgraph 
campaign: "G3W14"
submitPath: "{submitRoot}/{outCollection}"
saveDot: False
computeSite: ncsapool
requestMemory: 2048
requestCpus: 1

payload:
  runInit: true
  payloadName: rc2
  butlerConfig: /repo/main/butler.yaml
  inCollection: HSC/RC2/defaults
  output: "HSC/runs/RC2/w_2021_14/DM-29528"
  outCollection: "{output}/{timestamp}"
  #dataQuery: "tract = 9615 and instrument='HSC' and skymap='hsc_rings_v1'"
  dataQuery: "instrument='HSC' and skymap='hsc_rings_v1' and detector!=9 and detector.purpose='SCIENCE'"

pipetask:
  pipetaskInit:
    runQuantumCommand: ${CTRL_MPEXEC_DIR}/bin/pipetask --long-log run -b {butlerConfig} --output {output} --output-run {outCollection} --init-only --skip-existing --register-dataset-types --qgraph {qgraphFile} --no-versions
       
